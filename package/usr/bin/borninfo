#!/bin/bash

# Function to check if a command is available
check_command() {
    command -v "$1" >/dev/null 2>&1 || { echo "$1 command not found. Skipping..."; return 1; }
    return 0
}

# Function to print architecture
print_architecture() {
    echo "# Architecture: $(uname -a)"
}

# Function to print physical CPUs
print_cpu_physical() {
    check_command lscpu && echo "# CPU physical: $(lscpu | awk '/Socket/{print $2}')"
}

# Function to print virtual CPUs
print_vcpu() {
    echo "# vCPU: $(nproc)"
}

# Function to print memory usage
print_memory() {
    check_command free && memory_usage=$(free --mega | awk '/Mem/{printf("%d/%dMB (%.2f%%)", $3, $2, ($3 / $2) * 100)}')
    echo "# Memory Usage: $memory_usage"
}

# Function to print disk usage
print_disk() {
    check_command df && disk_usage=$(df -m --total | awk '/total/{printf "%d/%dGb (%s)\n", $3, $2/1024 ,$5}')
    echo "# Disk Usage: $disk_usage"
}

# Function to print CPU load
print_cpu_load() {
    check_command sar && cpu_load=$(sar -u 1 1 | awk 'END{print 100 - $8}')
    echo "# CPU load: $cpu_load%"
}

# Function to print last boot time
print_last_boot() {
    check_command who && last_boot=$(uptime -s | cut -d ':' -f1,2)
    echo "# Last boot: $last_boot"
}

# Function to check if LVM is in use
print_lvm() {
    check_command lsblk && lvm_use=$(lsblk 2> /dev/null | grep -q 'lvm' && echo yes || echo no)
    echo "# LVM use: $lvm_use"
}

# Function to print established TCP connections
print_tcp_connections() {
    check_command netstat && connections_tcp=$(netstat -an | grep -c ESTAB)
    echo "# TCP Connections: $connections_tcp ESTABLISHED"
}

# Function to print number of logged-in users
print_user_log() {
    check_command who && user_log=$(who | wc -l)
    echo "# User logins: $user_log"
}

# Function to print network information (IP and MAC)
print_network() {
    network_ip=$(hostname -I | cut -d ' ' -f1)
    network_mac=$(ip link | awk 'END{print $2}')
    echo "# Network: IP $network_ip ($network_mac)"
}

# Function to print number of sudo commands used
print_sudo_count() {
    check_command journalctl && sudo_count=$(journalctl -q _COMM=sudo | grep -c COMMAND)
    echo "# Sudo : $sudo_count cmd"
}

# Function to print help message
print_help() {
    cat << EOF
Usage: borninfo [OPTIONS]

Options:
  -a, --all              Show all information
  -r, --architecture     Show system architecture
  -c, --cpu-physical     Show number of physical CPUs
  -v, --vcpu             Show number of virtual CPUs
  -m, --memory           Show memory usage
  -d, --disk             Show disk usage
  -l, --cpu-load         Show CPU load
  -b, --last-boot        Show last boot time
      --lvm              Show if LVM is in use
  -t, --tcp              Show established TCP connections
  -u, --user-log         Show number of logged-in users
  -n, --network          Show network information (IP and MAC)
  -s, --sudo             Show number of sudo commands used
  -h, --help             Display this help message
EOF
}

# Function to print all information
print_all() {
    print_architecture
    print_cpu_physical
    print_vcpu
    print_memory
    print_disk
    print_cpu_load
    print_last_boot
    print_lvm
    print_tcp_connections
    print_user_log
    print_network
    print_sudo_count
}

# Handle user input (argument parsing)
case "$1" in
    -a|--all)
        print_all
        ;;
    -r|--architecture)
        print_architecture
        ;;
    -c|--cpu-physical)
        print_cpu_physical
        ;;
    -v|--vcpu)
        print_vcpu
        ;;
    -m|--memory)
        print_memory
        ;;
    -d|--disk)
        print_disk
        ;;
    -l|--cpu-load)
        print_cpu_load
        ;;
    -b|--last-boot)
        print_last_boot
        ;;
    --lvm)
        print_lvm
        ;;
    -t|--tcp)
        print_tcp_connections
        ;;
    -u|--user-log)
        print_user_log
        ;;
    -n|--network)
        print_network
        ;;
    -s|--sudo)
        print_sudo_count
        ;;
    -h|--help)
        print_help
        ;;
    *)
        echo "Invalid option. Use -h or --help for usage information."
        ;;
esac
